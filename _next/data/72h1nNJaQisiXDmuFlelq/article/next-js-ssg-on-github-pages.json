{"pageProps":{"article":{"id":"next-js-ssg-on-github-pages","title":"Next.js の SSG 機能で生成した静的サイトを GitHub Actions 経由で GitHub Pages に公開する","description":"Next.js の SSG 機能で生成した静的サイトを GitHub Actions 経由で GitHub Pages に公開する手順です。","createdAt":"2020/09/10","updatedAt":"2021/07/11","content":"<h1>Next.js の SSG 機能で生成した静的サイトを GitHub Actions 経由で GitHub Pages に公開する</h1>\n<h2>Next.js で SSG する</h2>\n<ul>\n<li><code>next build</code> 後に <code>next export</code> で、<code>out</code> フォルダに HTML, CSS, JS 等が出力される</li>\n<li><code>package.json</code> の <code>scripts</code> に 以下あたりを追加しておく</li>\n</ul>\n<pre class=\"hljs lang-json\">{\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"build\"</span>: <span class=\"hljs-string\">\"next build &amp;&amp; next export\"</span>\n  }\n}\n</pre>\n<h2>GitHub Actions の設定</h2>\n<ul>\n<li><code>.github/workflows</code> ディレクトリ配下に適当な名前で以下のような yml を作成</li>\n<li>公開ディレクトリ直下に <code>.nojekyll</code> といったファイルがないと、<code>_next</code> ディレクトリが公開されないようなので、ビルド後に作成している</li>\n<li><a href=\"https://github.com/sidearrow/sidearrow.github.io/blob/master/.github/workflows/deploy.yml\">実際の設定ファイル</a></li>\n<li>GitHub の個人アクセストークンを作成し、環境変数に設定する必要があります</li>\n</ul>\n<pre class=\"hljs lang-yaml\"><span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">deploy</span> <span class=\"hljs-string\">to</span> <span class=\"hljs-string\">github</span> <span class=\"hljs-string\">pages</span>\n<span class=\"hljs-attr\">on:</span>\n  <span class=\"hljs-attr\">push:</span>\n    <span class=\"hljs-attr\">branches:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">master</span>\n<span class=\"hljs-attr\">jobs:</span>\n  <span class=\"hljs-attr\">deploy:</span>\n    <span class=\"hljs-attr\">runs-on:</span> <span class=\"hljs-string\">ubuntu-latest</span>\n    <span class=\"hljs-attr\">steps:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/checkout@v2</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">actions/setup-node@v2.1.0</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">node-version:</span> <span class=\"hljs-number\">12.</span><span class=\"hljs-string\">x</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">install</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">yarn</span> <span class=\"hljs-string\">install</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">build</span>\n        <span class=\"hljs-attr\">run:</span> <span class=\"hljs-string\">|\n          yarn run build\n          touch out/.nojekyll\n</span>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">deploy</span>\n        <span class=\"hljs-attr\">uses:</span> <span class=\"hljs-string\">peaceiris/actions-gh-pages@v3.6.4</span>\n        <span class=\"hljs-attr\">with:</span>\n          <span class=\"hljs-attr\">github_token:</span> <span class=\"hljs-string\">${{</span> <span class=\"hljs-string\">secrets.GITHUB_TOKEN</span> <span class=\"hljs-string\">}}</span>\n          <span class=\"hljs-attr\">publish_dir:</span> <span class=\"hljs-string\">./out</span>\n</pre>\n","tags":[]}},"__N_SSG":true}